## 블록체인정리



### 블록체인이란

* 분산원장 기술이라고 한다.
* 거래내역을 기록한 원장을 다수의 사람들에게 분산하여 저장/관리하는 기술이다.
* 다수의 온라인 거래 기록을 묶어 하나의 **데이터 블록**을 구성하고 **해쉬 값**을 이용하여 이전 블록과 이후 블록을 **체인**처럼 연결한 뒤, 이 정보의 전부 또는 일부를 **P2P** 방식으로 전 세계 컴퓨터에 복사하여 분산 저장/관리하는 기술이다.
* 블록체인이 작동하기 위해서는 다수의 거래내역을 묶어 블록을 구성하고, 이 블록을 기존 블록체인의 끝에 연결하며, 다수의 컴퓨터에 P2P 방식으로 분산 저장해야 한다.



### 블록 구성

* 블록체인을 만들기 위해서는 다수의 거래 기록을 묶어 하나의 블록을 먼저 구성해야 한다.
* 거래의 최소 단위는 **트랜잭션(transaction, Tx)**이다. 
* 트랜잭션은 더 이상 쪼갤 수 없는 업무 최소 단위이다. 예를 들어, `a가 b에게 돈을 지급하고 b가 받은 경우` 는 더 이상 쪼갤 수 없는 최소 단위인 트랜잭션이다. 
* 온라인에서 거래가 발생한 경우, 각각의 트랜잭션 별로 하나의 거래내역을 구성한다. 이 거래내역은 해시 함수를 사용하여 암호화한다.
* 블록체인에서는 다수의 거래내역을 묶어 하나의 블록을 구성한다. 거래 내역이 많든 적든 항상 일정한 시간에 한 번씩 새로운 블록을 구성한다. 
* 하나의 블록에는 하나의 루트해시가 생성된다. 이러한 해시값의 구조를 해시트리라고 한다.
* 하나의 블록에 반드시 하나의 루트해시가 존재한다. 만약 거래내역 중 하나라도 위변조할 경우 해당 해시값과 그 상위의 모든 해시값이 변경되어 결과적으로 루트해시가 달라지게 된다. 즉, 루트해시만 비교하면 하위의 해시를 검사하지 않아도 데이터의 위변조를 확인할 수 있다.
* 새로 구성된 블록은 타임스탬프 서버에 의해 생성된 시간이 기록되며, 전체 네트워크에 전파된다.
* 타임스탬프는 전자문서가 특정한 시점에 존재하고 있었다는 '존재 증명'과 그 이후 데이터가 변경되지 않았다는 '내용 증명'을 해 주는 전자도장이다.



### 체인 연결

* 하나의 새 블록을 구성한 경우, 체인처럼 이어져 내려오던 블록체인의 맨 끝에 이 새로운 블록을 연결시켜야 한다. 
* 새 블록을 기존 블록체인의 끝에 연결시키려면, 해당 블록의 이름에 해당하는 해시값을 찾아야 한다. 
* 새로운 해시값을 성공적으로 찾아내야 새로운 블록이 생성되어 기존 블록체인이 연결된다.
* 새 블록의 이름에 해당하는 해시를 찾아내는 일은 미리 정해진 목표값보다 작아야 한다는 조건을 충족해야 한다.
* 목표 해시가 `00ff32`이고 새로 찾은 해시값이 `12fa3b`라면 조건에 맞지 않기 때문에, 블록 생성에 실패한다.
* 블록의 해시값은 해당 블록의 생성일시, 버전, 비츠, 루트해시, 이전 블록의 해시, 그리고 **논스**라 불리는 임시값 등을 조합 후 변환하여 생성한다.
* 논스라는 임시값 외에는 모두 정해진 값이지만, 논스라는 값이 달라짐에 따라 해시 값이 다양하게 나온다.
* 이 논스값을 수없이 바꿔가며 조건에 성립할 경우, 새로운 블록이 생성된다.
* 이처럼 특정 블록에 대해 목표값 이하의 크기를 가진 해시값을 찾음으로써 새로운 블록을 생성하는 행위를 **작업증명**이라고 한다. 
* 이 대가로 암호화폐를 지급받는 것을 채굴이라고 한다.



### P2P 분산 저장

* 블록체인은 거래를 처리하고 기록/관리하는 중앙 조직없이, 네트워크에 연결된 개별 참여자들에 의해 유지된다.
* P2P란 Peer(동료) to Peer의 약자로써, 인터넷의 연결된 개별 사용자들이 직접 데이터를 주고 받는 것을 뜻한다.
* P2P의 형태에서는 네트워크의 참여자가 모두 평등한 구조를 가진다.
* 블록체인에 저장된 데이터는 네트워크에 연결된 모든 노드에 분산되어 저장된다. 
* 노드란 네트워크를 구성하는 각가의 개체로, 개별 컴퓨터가 하나의 노드가 된다.
* 블록체인에 저장된 데이터는 원본과 사본의 구별이 없이, 복사하여 모든 노드에 저장함으로써 서로 동일한 데이터를 가진다.
* 이 때, 해당 전체를 동일하게 복사한 노드를 풀 노드(full node)라고 하고, 일부만 복사한 노드를 라이트 노드(light node)라 한다.
* 블록체인 네트워크에서 새 거래가 발생할 경우 그 내역은 모든 노드들에게 전파된다. 일정 시간동안 이루어진 모든 거래를 하나로 묶어 새로운 블록을 구성하고, 목표값 이하의 해시값을 찾기 위해 경쟁한다.
* 경쟁에서 가장 만저 블록 해시값을 찾아낸 노드가 승리한다. 그 후, 자신이 승리했음을 전체 네트워크에 알린다. 네트워크에 참여한 다른 노드들은 새 생성된 블록의 유효성을 검사하고, 아무런 이상이 없을 경우 해당 블록을 승인한다.
* 이런 방식으로 과반수 노드가 승인할 경우, 해당 블록은 블록체인에 추가된다. 
* 서로 다른 거래내역을 가진 블록이 동시에 생성될 경우 네트워크는 기다리다가 가장 긴 길이의 체인을 선택한다. 이 때 다른 선택되지 않은 체인은 엉클체인이라고 하며, 그 체인의 블록을 고아블록이라 한다.
* 엉클체인은 버려지게 된다. 
* 이렇게 엉클체인이 버려진다고 하여도, 같은 시간대에 생성된 다른 블록에 동일한 정보가 있을 확률이 크다. 물론 정확히 일치한다고 할 수는 없지만, 다른 블록에 포함되지 못한 트랜잭션은 그 블록의 다음 블록에 존재할 것이다.
* 블록체인에는 원본 데이터와 원본데이터를 변환한 해시 데이터가 들어갈 수 있는데, 원본 데이터를 올리면 용량이 커지고 속도가 느려져서 효율의 문제가 생긴다. 따라서 해시값만 저장하고, 원본 데이터는 별도의 서버에 저장하게 된다.
* 만일 해커가 서버를 공격하더라도 전 세계 모든 노드의 해시값을 동시에 위변조하지 않는다면 조작이 된다.



### 솔리디티

* 솔리디티는 2014년 8월 개빈 우드(Gavin Wood)의 팀에 의해 개발되었다. 
* 스마트 계약을 작성하기 위한 고수준 언어.
  * 스마트 계약 : 계약 당사자가 사전에 협의한 내용을 전자 계약서 문서에 넣고, 계약 조건이 충족되면 자동으로 계약 내용이 실행되도록 하는 시스템. 
* EVM을 타깃으로 디자인된 솔리디티는 정적 타입이고, 여러 기능 중 상속, 라이브러리, 유저 정의 타입을 지원한다.
* 튜링완전이라는 특성을 가진 솔리디티는 반복문과 제어문을 사용할 수 있다.
  * 튜링 완전 : 앨런 튜링의 머신과 동일한 계산 능력을 가짐. 



### P2P

### 블록 구성

### 블록 연결

